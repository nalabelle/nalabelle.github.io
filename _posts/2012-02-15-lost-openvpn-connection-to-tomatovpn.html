---
layout: post
title: Lost OpenVPN Connection to TomatoVPN
categories:
- IT
tags: []
status: publish
type: post
published: true
meta:
  _edit_last: '1'
---
This is directed toward a pretty specific audience, so this probably won't be too useful for many people. If you have <a href="http://tomatovpn.keithmoyer.com/">TomatoVPN</a> with OpenVPN set up, sometimes the <a href="http://openvpn.net/">OpenVPN</a> server will go down, and you'll lose access. It's happened to me many times where all of a sudden, I get a disconnect and an error like the following in my logs:

<code>Feb 15 11:34:34 localbox ovpn-client[2621]: TLS Error: TLS key negotiation failed to occur within 60 seconds (check your network connectivity)
Feb 15 11:34:34 localboxÂ ovpn-client[2621]: TLS Error: TLS handshake failed</code>

Due to this, I've come up with a routine to work around the problem. First, you need to make sure you can SSH in from outside your network. The settings I use look like this:

<a href="http://hypertoast.net/blog/wp-content/uploads/2012/02/tomato.png"><img class="alignnone size-medium wp-image-32" title="TomatoVPN SSH Settings" src="http://hypertoast.net/blog/wp-content/uploads/2012/02/tomato-300x194.png" alt="" width="300" height="194" /></a>

Assuming you can still SSH in, the process to restart the OpenVPN server is pretty simple. Just use the option -D and specify a port, to set up a proxy for your web browser.

<code>ssh -D 1800 root@yourtomato</code>

After that, configure the proxy on your local machine or browser to use localhost on port 1800, and you should be able to reach Tomato on its LAN IP.
